---
title: "masters_thesis_air_pollution_schools_results"
author: "Steven Futter"
date: "7/15/2017"
output: html_document
---

```{r}
# createDataFrame = function(df,predictor){
#   dfNew = df %>% select(Time, Year, Month, TimeHoursNum,                  # date Time variables
#                         lag.1.NO:lag.5.WSPD,                              # lagged meteorological and pollutant variables
#                         BP.IMP:WSPD.IMP,                                  # use current hour meteorological variable inputs (assumed provided by MET office UK)
#                         X5amTo8amSlope.NO2.IMP: X2amTo5amSlope.WSPD.IMP)  # arima slopes-proxy
#   dfPred = df[,predictor]
#   dfNew = cbind(dfPred, dfNew)
#   colnames(dfNew)[1] = paste0(predictor)
#   return(dfNew)
# }

infilePath = file.path("~/Dropbox","NU","THESIS","DATASETS","RESULTS", "PREDICTIONS","ONE_HOUR_AHEAD_PREDICTIONS")
df         = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_1_hr_ahead.csv"),na.strings=c("NA"," "))
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_2_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_3_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_4_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_5_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_6_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_7_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_test_8_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
df

# SORT BY DATE & TIME
str(df)
df$Time = as.POSIXct(df$Time)
dplyr::arrange(df, Time)
df

# CALC the MAE here
# TESTING: evaluate the quality of the prediction using the test data set:
df.test.mae = mean(abs(df$predict-df$NO2))
df.test.mae          # 6.076698 NO2




# REPEAT FOR VALIDATION DATA SET
infilePath = file.path("~/Dropbox","NU","THESIS","DATASETS","RESULTS", "PREDICTIONS","ONE_HOUR_AHEAD_PREDICTIONS")
df         = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_1_hr_ahead.csv"),na.strings=c("NA"," "))
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_2_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_3_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_4_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_5_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_6_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_7_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
dfNew      = read.csv(file.path(infilePath,"greenwich_eltham_NO2_ann_vali_8_hr_ahead.csv"),na.strings=c("NA"," "))
df = rbind(df, dfNew)
df

# CALC the MAE here
# VALIDATION: evaluate the quality of the prediction using the test data set
df.vali.mae = mean(abs(df$predict-df$NO2))
df.vali.mae          # 6.431038 NO2



df.test.mae
df.vali.mae


```



# DRAW PLOTLY OF DAILY PREDICT VS ACTUAL FOR DAYS WHEN OVER 40 ... 
# DRAW TABLE WITH NUMBER OF TIMES >40 WHERE PREDICT ACCURATE